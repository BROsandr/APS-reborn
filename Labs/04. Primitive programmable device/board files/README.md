# Проверка работы CYBERcobra на ПЛИС

После того, как вы проверили на моделировании дизайн, вам необходимо проверить его работу на прототипе в ПЛИС.

Инструкция по реализации прототипа описана [здесь](../../../Vivado%20Basics/How%20to%20program%20an%20fpga%20board.md).

На _рис. 1_ представлена схема прототипа в ПЛИС.

![../../../.pic/Labs/board%20files/nexys_cobra_structure.drawio.svg](../../../.pic/Labs/board%20files/nexys_cobra_structure.drawio.svg)

_Рисунок 1. Структурная схема модуля `nexys_CYBERcobra`._

Прототип позволяет потактово исполнять программу, прошитую в память инструкций. Также прототип отображает операцию исполняемую в данный момент.

> [!NOTE]
> Объекта модуля `instr_mem` в модуле `CYBERcobra` **должен** называться `instr_mem` (т.е. строка объявления модуля выглядит: `instr_mem  instr_mem(...)`.

## Описание используемой периферии

-   ### Переключатели.

    Значение с переключателей `SW[15:0]` подаются напрямую на порт `sw_i` модуля дизайна.

-   ### Кнопки

    -   `BTND` — при нажатии создает тактовый импульс, поступающий на порт тактирования `clk_i` модуля дизайна.
    -   `CPU_RESET` — соединен со входом `rst_i` модуля дизайна.

-   ### Светодиоды

    Светодиоды `LED[14:0]` отображают нижние 16 бит значения, выставленного в данный момент на порте `out_o` модуля дизайна.

-   ### Семисегментные индикаторы

    Пронумеруем индикаторы от `0` до `7`, индикатор `7` является крайним левым. Семисегментные индикаторы разбиты на 3 блока:

    -   `[7:6]` — Отображают нижние 8 бит значения, выставленного в данный момент на порте `out_o` модуля дизайна, в виде шестнадцатеричного числа.
    -   `[5:4]` — Отображают нижние 8 бит значения, выставленного в данный момент на порте `addr_i` модуля `instr_mem`, в виде шестнадцатеричного числа. Значение этого сигнала соответствует значению программного счетчика в данный момент.
    -   `[3:0]` — Отображают [операцию](#операции-отображаемые-прототипом), которую CYBERcobra исполняется в данный момент, в виде набора букв английского алфавита, а также символа пробела. Прототип определяет операцию путем декодирования значения, выставленного в данный момент на порте `read_data_o` модуля `instr_mem`.

## Операции, отображаемые прототипом

Алфавит представлен на _рис. 2_:

!['../../../.pic/Labs/board%20files/semseg_alphabet.png'](../../../.pic/Labs/board%20files/semseg_alphabet.png)

_Рисунок 2. Алфавит, отображаемый прототипом на семисегментных индикаторах._

Соответствие типа инструкции отображаемой операции:

1.  Вычислительные — отображается вычислительная операция, исполняемая на АЛУ (например, ADD).
1.  Инструкция загрузки константы — **l**oad **i**mmediate.
1.  Инструкция загрузки из внешних устройств — **in**put.
1.  Безусловный переход — jump
1.  Инструкций условного перехода — отображается операция вычисления флага, исполняемая на АЛУ (например, LES).

Во время исполнения вычислительных инструкций и инструкций условного перехода могут встретиться нелегальные операции (отображается как **ill**egal). Операция считается нелегальной в следующих случаях:

-   Если в поле инструкции, отвечающем за операция АЛУ, указана битовая последовательность, не входящая в диапазон допустимых значений.
-   Если инструкций является вычислительной, но в поле инструкции, отвечающем за операция АЛУ, указана битовая последовательность, соответствующая операции, вычисляющей флаг. И обратный случай.

Инструкция `0 0 11 xxxxxxxxxxxxxxxxxxxxxxxxxxxx` отображается как **n**o **op**eration.

## Демонстрационная программа

Демонстрационная программа, написанная на языке ассемблера, представлена ниже.

```assembly
0x00: li x1, 32
0x04: add x0, x1, x0
0x08: add x2, x2, x3
0x0C: sub x2, x2, x3
0x10: xor x2, x2, x3
0x14: or x2, x2, x3
0x18: and x2, x2, x3
0x1C: sra x2, x2, x3
0x20: srl x2, x2, x3
0x24: sll x2, x2, x3
0x28: lts x0, x1, 10
0x2C: ltu x0, x1, 10
0x30: ges x1, x0, 10
0x34: geu x1, x0, 10
0x38: eq x0, x0, 10
0x3C: ne x1, x0, 10
0x40: lts x1, x2, x3
0x44: ltu x1, x2, x3
0x48: in x1
0x4C: jump -19
0x50: jump -9
0x54: jump -9
0x58: jump -9
0x5C: jump -9
0x60: jump -9
0x64: jump -9
```

Программа содержит все инструкции из ISA, кроме нелегальных и `no operation`. Вначале каждой строки указан адрес инструкции в `instr_mem` в шестнадцатеричном формате. После выполнения всех инструкций осуществляется безусловный переход в самое начало программы, зацикливая программу таким образом. Версия этой программы, транслированная в машинные коды, находится в файле [demo.mem](./demo.mem).

<!-- Как демонстрация, на _рис. 2_ изображено состояние прототипа на ПЛИС во время исполнения инструкции по адресу `0x04`. -->
